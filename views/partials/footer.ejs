<div id="toast-container"></div>

<div id="confirm-modal" class="modal-overlay">
    <div class="modal-box">
        <h3 id="confirm-title" style="margin-top:0;">Sicher?</h3>
        <p id="confirm-text" style="color: #64748b; margin-bottom: 25px;">...</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="btn btn-outline" onclick="closeConfirm(false)">Abbrechen</button>
            <button id="confirm-btn-yes" class="btn" onclick="closeConfirm(true)">Ja, machen!</button>
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div style="margin-bottom: 20px;">
            <h3 style="color:white; margin:0;">EASYMENSA</h3>
            <p style="font-size: 0.9rem;">Dein Schulbuffet. Frisch, schnell, modern.</p>
        </div>

        <div style="border-top: 1px solid #334155; padding-top: 20px; display: flex; flex-direction: column; gap: 10px;">
            <p>&copy; 2026 EASYMENSA Schulbuffet</p>
            
            <div style="display: flex; justify-content: center; font-size: 0.8rem;">
                <a href="/admin" style="background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; text-decoration: none; color: #cbd5e1;">
                    üîí Admin Login
                </a>
            </div>
        </div>
    </div>
</footer>

<script>
    // --- 1. TOAST SYSTEM (Nachrichten statt Alerts) ---
    function showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        if(!container) return;

        const toast = document.createElement('div');
        
        let icon = '‚ÑπÔ∏è';
        if (type === 'success') icon = '‚úÖ';
        if (type === 'error') icon = '‚õî';

        toast.className = `toast ${type}`;
        toast.innerHTML = `
            <div style="font-size: 1.2rem;">${icon}</div>
            <div>${message}</div>
        `;

        container.appendChild(toast);

        // Animation rein
        requestAnimationFrame(() => toast.classList.add('show'));

        // Nach 3 Sekunden raus
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // --- 2. CONFIRM SYSTEM (Eigener Dialog statt confirm()) ---
    let confirmCallback = null;

    function showConfirm(title, text, callback) {
        document.getElementById('confirm-title').innerText = title;
        document.getElementById('confirm-text').innerText = text;
        document.getElementById('confirm-modal').style.display = 'flex';
        confirmCallback = callback;
    }

    function closeConfirm(result) {
        document.getElementById('confirm-modal').style.display = 'none';
        if (result && confirmCallback) confirmCallback();
        confirmCallback = null;
    }

    // --- 3. WARENKORB LOGIK ---
    function getCart() { return JSON.parse(localStorage.getItem('cart') || '[]'); }
    function saveCart(cart) { localStorage.setItem('cart', JSON.stringify(cart)); }

    function updateCartCount() {
        const cart = getCart();
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        const badge = document.getElementById('cart-count');
        if (badge) badge.innerText = count;
    }

    // Die zentrale Funktion zum Hinzuf√ºgen
    function addToCart(id, name, price, type, day = null) {
        let cart = getCart();

        // Check: Wenn schon ein Mittagessen f√ºr einen ANDEREN Tag drin ist -> Fehler
        const existingLunch = cart.find(i => i.type === 'lunch');
        if (type === 'lunch' && existingLunch && existingLunch.day !== day) {
            showToast(`Du hast schon ein Essen f√ºr ${existingLunch.day} im Korb! Bitte bestelle getrennt.`, 'error');
            return;
        }

        let existingItem = cart.find(i => i.name === name && i.day === day);

        if (existingItem) {
            existingItem.quantity++;
        } else {
            cart.push({ 
                id, 
                name, 
                price, 
                type,   // 'lunch' oder 'snack'
                day,    // z.B. 'Montag' oder null
                quantity: 1 
            });
        }

        saveCart(cart);
        updateCartCount();
        
        // Sch√∂ne Erfolgsmeldung
        showToast(`${name} hinzugef√ºgt!`, 'success');
    }

    // Beim Laden der Seite Z√§hler aktualisieren
    document.addEventListener('DOMContentLoaded', updateCartCount);
</script>